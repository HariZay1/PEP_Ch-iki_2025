{% extends "layout.html" %}

{% block title %}Proyectos - PEP Gelatinas Ch'iki 2025{% endblock %}

{% block content %}
<div class="container">
    <div class="d-flex justify-content-between align-items-center mb-4">
        <div>
            <h1 class="display-6 mb-2">
                <i class="bi bi-folder-fill text-primary"></i> 
                Mis Proyectos
            </h1>
            <p class="text-muted mb-0">Gestión de proyectos de gelatinas con chips</p>
        </div>
        <a href="{{ url_for('create_proyecto') }}" class="btn btn-vrash">
            <i class="bi bi-plus-circle me-2"></i>Nuevo Proyecto
        </a>
    </div>

    {% if proyectos %}
        <div class="row">
            {% for proyecto in proyectos %}
            <div class="col-md-6 col-lg-4 mb-4">
                <div class="card card-vrash h-100">
                    <div class="card-header card-header-vrash d-flex justify-content-between align-items-center">
                        <h5 class="mb-0">{{ proyecto.nombre[:30] }}{% if proyecto.nombre|length > 30 %}...{% endif %}</h5>
                        <span class="badge estado-{{ proyecto.estado }}">
                            {{ proyecto.estado|title }}
                        </span>
                    </div>
                    <div class="card-body">
                        <p class="text-muted mb-2">
                            <i class="bi bi-building me-2"></i>{{ proyecto.empresa }}
                        </p>
                        <p class="text-muted mb-3">
                            <i class="bi bi-box me-2"></i>{{ proyecto.producto[:40] }}{% if proyecto.producto|length > 40 %}...{% endif %}
                        </p>
                        
                        <div class="mb-3">
                            <small class="text-muted">Períodos:</small>
                            <strong class="ms-2">{{ proyecto.periodos }} días</strong>
                        </div>
                        
                        <div class="mb-3">
                            <small class="text-muted">Inversión:</small>
                            <strong class="ms-2">{{ formatCurrency(proyecto.inversion_inicial) }}</strong>
                        </div>
                        
                        {% if proyecto.indicador %}
                        <div class="mb-3">
                            <small class="text-muted">VAN:</small>
                            <strong class="ms-2 {% if proyecto.indicador.van > 0 %}text-success{% else %}text-danger{% endif %}">
                                {{ formatCurrency(proyecto.indicador.van) }}
                            </strong>
                        </div>
                        <div class="mb-3">
                            <small class="text-muted">TIR:</small>
                            <strong class="ms-2">{{ formatPercent(proyecto.indicador.tir) }}</strong>
                        </div>
                        <div class="alert alert-{{ 'success' if proyecto.indicador.decision == 'ACEPTAR' else 'danger' }} py-2 mb-0">
                            <i class="bi bi-{{ 'check-circle' if proyecto.indicador.decision == 'ACEPTAR' else 'x-circle' }} me-2"></i>
                            <strong>{{ proyecto.indicador.decision }}</strong>
                        </div>
                        {% else %}
                        <div class="alert alert-warning py-2">
                            <i class="bi bi-exclamation-triangle me-2"></i>
                            <strong>Sin calcular</strong>
                        </div>
                        {% endif %}
                    </div>
                    <div class="card-footer bg-transparent border-top-0 pt-0">
                        <div class="d-grid gap-2">
                            <a href="{{ url_for('show_proyecto', id=proyecto.id) }}" 
                               class="btn btn-outline-primary btn-sm">
                                <i class="bi bi-eye me-1"></i> Ver Detalles
                            </a>
                            <div class="btn-group" role="group">
                                <a href="{{ url_for('edit_proyecto', id=proyecto.id) }}" 
                                   class="btn btn-outline-secondary btn-sm">
                                    <i class="bi bi-pencil"></i>
                                </a>
                                <form action="{{ url_for('delete_proyecto', id=proyecto.id) }}" 
                                      method="POST" class="d-inline">
                                    <button type="submit" class="btn btn-outline-danger btn-sm"
                                            onclick="return confirm('¿Eliminar proyecto {{ proyecto.nombre }}?')">
                                        <i class="bi bi-trash"></i>
                                    </button>
                                </form>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            {% endfor %}
        </div>
    {% else %}
        <div class="card card-vrash">
            <div class="card-body text-center py-5">
                <i class="bi bi-inbox display-1 text-muted mb-3"></i>
                <h3 class="mb-3">No hay proyectos registrados</h3>
                <p class="text-muted mb-4">Comienza creando tu primer proyecto de evaluación</p>
                <a href="{{ url_for('create_proyecto') }}" class="btn btn-vrash">
                    <i class="bi bi-plus-circle me-2"></i> Crear Primer Proyecto
                </a>
            </div>
        </div>
    {% endif %}
</div>
{% endblock %}